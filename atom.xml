<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>i4ward</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.i4ward.cn/"/>
  <updated>2019-01-14T15:46:26.688Z</updated>
  <id>http://www.i4ward.cn/</id>
  
  <author>
    <name>i4ward</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一道关于多字段排序的问题</title>
    <link href="http://www.i4ward.cn/2019/01/14/%E4%B8%80%E9%81%93%E5%85%B3%E4%BA%8E%E5%A4%9A%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://www.i4ward.cn/2019/01/14/一道关于多字段排序的问题/</id>
    <published>2019-01-14T15:44:17.000Z</published>
    <updated>2019-01-14T15:46:26.688Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Sat Jan 19 2019 15:35:00 GMT+0800 (GMT+08:00) --><p>有一张关于用户游戏积分的数据表，表的字段如下 scores(id,uid,score,dateTime)，字段解释如下：</p><ol><li>id 分数记录主键</li><li>uid 用户id</li><li>score 分数</li><li>dateTime 产生记录的时间 说明：用户每天每个用户会产生多条记录。</li><li>Q1. 统计2018年4月份每天总分大于60，用户月活跃天数大于16的用户信息。</li><li>Q2. 使用php实现一个函数，可以多条件排序的。参考mysql多条件排序功能。</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: zx</span></span><br><span class="line"><span class="comment"> * Date: 2018/4/26</span></span><br><span class="line"><span class="comment"> * Time: 13:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">3</span>,<span class="string">'score'</span>=&gt;<span class="string">'20'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-3'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">1</span>,<span class="string">'score'</span>=&gt;<span class="string">'30'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-5'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">3</span>,<span class="string">'score'</span>=&gt;<span class="string">'20'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-4'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">2</span>,<span class="string">'score'</span>=&gt;<span class="string">'21'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-6'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">5</span>,<span class="string">'score'</span>=&gt;<span class="string">'33'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-9'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">6</span>,<span class="string">'score'</span>=&gt;<span class="string">'24'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-2'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">7</span>,<span class="string">'score'</span>=&gt;<span class="string">'28'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-1'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">6</span>,<span class="string">'score'</span>=&gt;<span class="string">'30'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-1'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">6</span>,<span class="string">'score'</span>=&gt;<span class="string">'41'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-1'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">1</span>,<span class="string">'score'</span>=&gt;<span class="string">'12'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-3'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">1</span>,<span class="string">'score'</span>=&gt;<span class="string">'17'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-5'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">2</span>,<span class="string">'score'</span>=&gt;<span class="string">'29'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-4'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">3</span>,<span class="string">'score'</span>=&gt;<span class="string">'30'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-3'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">4</span>,<span class="string">'score'</span>=&gt;<span class="string">'39'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-7'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">6</span>,<span class="string">'score'</span>=&gt;<span class="string">'40'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-8'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">8</span>,<span class="string">'score'</span>=&gt;<span class="string">'20'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-6'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">7</span>,<span class="string">'score'</span>=&gt;<span class="string">'50'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-4'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">8</span>,<span class="string">'score'</span>=&gt;<span class="string">'36'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-6'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">2</span>,<span class="string">'score'</span>=&gt;<span class="string">'70'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-4'</span>],</span><br><span class="line">    [<span class="string">'uid'</span>=&gt;<span class="number">4</span>,<span class="string">'score'</span>=&gt;<span class="string">'12'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'2018-4-9'</span>],</span><br><span class="line">            );</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">multiSort</span><span class="params">(array $arr, array $orders)</span></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span>($orders <span class="keyword">as</span> $orderField=&gt;$orderType)&#123;</span><br><span class="line">        $tmp = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">foreach</span>($arr <span class="keyword">as</span> $data)&#123;</span><br><span class="line">            array_push($tmp,$data[$orderField]);</span><br><span class="line">        &#125;</span><br><span class="line">        $orderType = strtolower($orderType)==<span class="string">'desc'</span>? SORT_DESC : SORT_ASC;</span><br><span class="line">        $orderMethod = is_string($tmp[<span class="number">0</span>])? SORT_STRING :SORT_NUMERIC;</span><br><span class="line">        array_multisort($tmp,$orderType,$orderMethod,$arr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $arr;</span><br><span class="line">&#125;</span><br><span class="line">$orders = [<span class="string">'uid'</span>=&gt;<span class="string">'asc'</span>,<span class="string">'score'</span>=&gt;<span class="string">'desc'</span>];</span><br><span class="line">$result = multiSort($arr,$orders);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">var_dump($result);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">umultiSort</span><span class="params">(array $arr, array $orders)</span></span>&#123;</span><br><span class="line">    usort($arr,<span class="function"><span class="keyword">function</span><span class="params">($a,$b)</span><span class="title">use</span><span class="params">($arr,$orders)</span></span>&#123;</span><br><span class="line">            <span class="keyword">foreach</span>($orders <span class="keyword">as</span> $orderField=&gt;$orderType)&#123;</span><br><span class="line">                <span class="keyword">if</span>(is_integer($a[$orderField]))&#123;</span><br><span class="line">                    <span class="keyword">if</span>(strtolower($orderType)==<span class="string">'desc'</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>($a[$orderField]==$b[$orderField])</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        <span class="keyword">return</span> $a[$orderField]&lt;$b[$orderField]?<span class="number">1</span>:<span class="number">-1</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>($a[$orderField]==$b[$orderField])</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        <span class="keyword">return</span> $a[$orderField]&gt;$b[$orderField]?<span class="number">1</span>:<span class="number">-1</span>;</span><br><span class="line">                    &#125;   </span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(strtolower($orderType)==<span class="string">'desc'</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(strcmp($a[$orderField],$b[$orderField])==<span class="number">0</span>)</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        <span class="keyword">return</span> strcmp($b[$orderField],$a[$orderField]);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(strcmp($a[$orderField],$b[$orderField])==<span class="number">0</span>)</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        <span class="keyword">return</span> strcmp($a[$orderField],$b[$orderField]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">return</span> $arr;</span><br><span class="line">&#125;</span><br><span class="line">$orders = [<span class="string">'uid'</span>=&gt;<span class="string">'asc'</span>,<span class="string">'score'</span>=&gt;<span class="string">'asc'</span>,<span class="string">'dateTime'</span>=&gt;<span class="string">'desc'</span>];</span><br><span class="line">$result = umultiSort($arr,$orders);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;hr/&gt;&lt;pre&gt;'</span>;</span><br><span class="line">var_dump($result);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br></pre></td></tr></table></figure><blockquote><p>mysql多条件排序时候，当第一个排序字段一致时会比较第二个字段进行排序以此类推。所以php实现的时候也需要遵守这种规则。</p></blockquote><p>上述php代码结果运行后发现使用array_multisort()实现的排序函数会出现后一个排序字段会覆盖前一个排序字段的规则（当然，其实可以避免这种情况，只要传入多个排序字段及规则。但是参数格式不好把握！）。而使用自定义排序规则函数usort()可以很好的避免这种情况。 关于array_multisort()和usort()性能及场景比较： arraycount=1000 usort排序执行时间为：0.034267902374268 s array_multisort排序执行时间为：0.0045900344848633 s</p><p>arraycount=10000 usort排序执行时间为：0.29996109008789 s array_multisort排序执行时间为：0.03429102897644 s</p><p>arratcount=100000 usort排序执行时间为：3.8284521102905 s array_multisort排序执行时间为：0.85004997253418 s 可以看出array_multisort的确要快很多，但对于数据量很小的排序usort可以做到更为灵活的业务处理。另外一点是使用usort比较同值排序时会出现排序随机的状态，做榜单类数据并不合适。</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Sat Jan 19 2019 15:35:00 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;有一张关于用户游戏积分的数据表，表的字段如下 scores(id,uid,score,dateTime)，字段解释如下：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;
      
    
    </summary>
    
      <category term="php" scheme="http://www.i4ward.cn/categories/php/"/>
    
    
      <category term="php" scheme="http://www.i4ward.cn/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>一个留言弹幕demo</title>
    <link href="http://www.i4ward.cn/2019/01/14/%E4%B8%80%E4%B8%AA%E7%95%99%E8%A8%80%E5%BC%B9%E5%B9%95demo/"/>
    <id>http://www.i4ward.cn/2019/01/14/一个留言弹幕demo/</id>
    <published>2019-01-14T15:17:51.000Z</published>
    <updated>2019-01-14T15:47:16.370Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Sat Jan 19 2019 15:35:00 GMT+0800 (GMT+08:00) --><p>最近项目上有用到swoole搭建的websocket去实现一些功能。趁着周末写了个弹幕，原理是一样的。</p><p>首先需要开启php的redis扩展及swoole扩展。</p><p>注意：需要在cli下开启这两个扩展。因为服务端脚本执行在php的cli模式下。 查看开启扩展 : php -m</p><p>下面就是服务端代码：<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author 4ward</span></span><br><span class="line"><span class="comment"> * Class myswoole</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myswoole</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $ws;   <span class="comment">//websocket连接句柄</span></span><br><span class="line">    <span class="keyword">private</span> $red;  <span class="comment">//redis连接句柄</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;myredis();      <span class="comment">// 连接redis</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;mywebsocket(); <span class="comment">// 开启websocket服务</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//websocket 服务端</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mywebsocket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//创建websocket服务器对象，监听0.0.0.0:9502端口</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws = <span class="keyword">new</span> swoole_websocket_server(<span class="string">"0.0.0.0"</span>, <span class="number">9502</span>);</span><br><span class="line">        <span class="comment">//初始化swoole服务</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;set(<span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'daemonize'</span>   =&gt; <span class="number">0</span>, <span class="comment">//是否作为守护进程,此配置一般配合log_file使用</span></span><br><span class="line">            <span class="string">'max_request'</span> =&gt; <span class="number">1000</span>,</span><br><span class="line">            <span class="string">'dispatch_mode'</span> =&gt; <span class="number">2</span>,</span><br><span class="line">            <span class="string">'debug_mode'</span> =&gt; <span class="number">1</span>,</span><br><span class="line">            <span class="string">'log_file'</span> =&gt; <span class="string">'swoole.log'</span>,</span><br><span class="line">            <span class="comment">// 心跳检测的设置，自动踢掉掉线的fd</span></span><br><span class="line">            <span class="string">'heartbeat_idle_time'</span> =&gt; <span class="number">600</span>,</span><br><span class="line">            <span class="string">'heartbeat_check_interval'</span> =&gt; <span class="number">60</span>,</span><br><span class="line">        ));</span><br><span class="line">        <span class="comment">//监听WebSocket连接开启事件</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">'WorkerStart'</span>, <span class="function"><span class="keyword">function</span><span class="params">($ws , $worker_id)</span></span>&#123;</span><br><span class="line">            <span class="comment">// 在Worker进程开启时绑定定时器</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"【date："</span>.date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">"】"</span>.$worker_id .<span class="string">" onWorkerStart... \n"</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//监听连接打开时间</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span><span class="params">($ws, $request)</span></span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"【date："</span>.date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">"】client "</span>.$request-&gt;fd.<span class="string">" has established...\n"</span>;</span><br><span class="line">            $msg = <span class="keyword">$this</span>-&gt;red-&gt;lrange(date(<span class="string">"Y-m-d"</span>,time()),<span class="number">0</span>,<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">foreach</span> ($msg <span class="keyword">as</span> $data)&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;ws-&gt;push($request-&gt;fd,json_encode((object)$data));</span><br><span class="line">                usleep(<span class="number">500000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//监听WebSocket消息事件</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">($ws, $frame)</span></span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"【data："</span>.date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">"】 Message: &#123;$frame-&gt;data&#125; \n"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;red-&gt;lpush(date(<span class="string">"Y-m-d"</span>,time()),$frame-&gt;data);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;ws-&gt;connections <span class="keyword">as</span> $id)&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;ws-&gt;push($id, json_encode((object)$frame-&gt;data));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//监听WebSocket连接关闭事件</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span><span class="params">($ws, $fd)</span></span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"【date："</span>.date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">"】client "</span>.$fd.<span class="string">" has established...\n"</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//开启服务</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//启动redis服务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">myredis</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;red = <span class="keyword">new</span> Redis();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;red-&gt;connect(<span class="string">'127.0.0.1'</span>,<span class="string">'6379'</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;red-&gt;select(<span class="number">5</span>); </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"【date："</span>.date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">"】redis service has started...\n"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$myswoole = <span class="keyword">new</span> myswoole;</span><br><span class="line"></span><br><span class="line">在cli下执行脚本及可：php server.php</span><br><span class="line"></span><br><span class="line">一个小问题：</span><br><span class="line">这是浏览器客户端代码。</span><br><span class="line"><span class="comment">//初始化ws</span></span><br><span class="line">  <span class="keyword">var</span> wsServer = <span class="string">"ws://127.0.0.1:9502"</span>;</span><br><span class="line">  websocket = <span class="keyword">new</span> WebSocket(wsServer);</span><br><span class="line">  websocket.onopen = <span class="function"><span class="keyword">function</span><span class="params">(evt)</span></span>&#123;</span><br><span class="line">      console.log(websocket.readyState+<span class="string">' websocket service established...'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//监听返回结果</span></span><br><span class="line">  websocket.onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(evt)</span></span>&#123;</span><br><span class="line">      <span class="keyword">var</span> data = JSON.parse(evt.data);</span><br><span class="line">      console.log(data);</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> i in data)&#123;</span><br><span class="line">          barrageWall.upWall(<span class="string">"images/aq.png"</span>,<span class="string">"我是说话人"</span>,data[i]);<span class="comment">//初始化弹幕墙</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p></p><p>总体功能上我是这样想的，当用户点开页面，建立会话连接，此时将之前的（一天内）弹幕信息全部取出来，广播给用户。 但是结合前端页面实际效果是，所有弹幕会在一个垂直的竖排显示。 我尝试着在循环时候加上类似于php的sleep(N)函数功能的代码。最后的效果是等待N次循环秒数之和后，全部在弹幕上以垂直竖排的方式输出。 无奈之下，只好在后端每次只发一条数据信息，并且设置合理的时间间隔，前端才会有想要的效果。 熬夜伤身体，所以我更倾向于通宵。开个玩笑！很晚了，我得睡了= = 这个问题留着，改日再究！</p><p>所有的demo文件已经上传到我的github上，需要的可以参考下载。<a href="https://github.com/i4ward/Barrage" target="_blank" rel="noopener">弹幕demo</a></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Sat Jan 19 2019 15:35:00 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;最近项目上有用到swoole搭建的websocket去实现一些功能。趁着周末写了个弹幕，原理是一样的。&lt;/p&gt;&lt;p&gt;首先需要开启php的redi
      
    
    </summary>
    
      <category term="php" scheme="http://www.i4ward.cn/categories/php/"/>
    
    
      <category term="php" scheme="http://www.i4ward.cn/tags/php/"/>
    
      <category term="swoole" scheme="http://www.i4ward.cn/tags/swoole/"/>
    
  </entry>
  
  <entry>
    <title>hello world</title>
    <link href="http://www.i4ward.cn/2019/01/14/first/"/>
    <id>http://www.i4ward.cn/2019/01/14/first/</id>
    <published>2019-01-14T14:25:00.284Z</published>
    <updated>2019-01-14T14:25:00.284Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Sat Jan 19 2019 15:35:00 GMT+0800 (GMT+08:00) --><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World!"></a>Hello World!</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Hello World!'</span>;</span><br></pre></td></tr></table></figure><a id="more"></a><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Sat Jan 19 2019 15:35:00 GMT+0800 (GMT+08:00) --&gt;&lt;h3 id=&quot;Hello-World&quot;&gt;&lt;a href=&quot;#Hello-World&quot; class=&quot;headerlink&quot; title=&quot;Hello World!&quot;&gt;&lt;/a&gt;Hello World!&lt;/h3&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Hello World!&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="php" scheme="http://www.i4ward.cn/categories/php/"/>
    
    
      <category term="php" scheme="http://www.i4ward.cn/tags/php/"/>
    
      <category term="helloWorld" scheme="http://www.i4ward.cn/tags/helloWorld/"/>
    
  </entry>
  
  <entry>
    <title>写给2017</title>
    <link href="http://www.i4ward.cn/2018/01/09/%E5%86%99%E7%BB%992017/"/>
    <id>http://www.i4ward.cn/2018/01/09/写给2017/</id>
    <published>2018-01-09T15:49:20.000Z</published>
    <updated>2019-01-14T15:51:41.807Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Sat Jan 19 2019 15:35:00 GMT+0800 (GMT+08:00) --><p>过去的一年是个百感交集的一年。毕业的欣喜，离别的惆怅，求职以及工作的艰辛。都在这不短不长，不声不响的一年中发生着。</p><h2 id="充实的日子"><a href="#充实的日子" class="headerlink" title="充实的日子"></a>充实的日子</h2><p>这一年最充实的大概是写毕设的那段时光了，找素材、写页面、写功能，经常熬夜到很晚。毕业之前就扯犊子嚷嚷着要做C站（AB站相仿）,虽说是玩笑话，我去尽全力用代码去实现了。成品虽然拙陋，但是每每拿出来自己欣赏，还是觉得是件值得骄傲的事情。毕设答辩虽然只拿到中（没有申请校答辩，自己也不擅表达），但还是觉得很满足。多年后，也许我会指着自己的毕设说，看！我实现了我所说的话，我做到了，没有什么遗憾的了。</p><h2 id="破碎的友谊"><a href="#破碎的友谊" class="headerlink" title="破碎的友谊"></a>破碎的友谊</h2><p>也许回不到曾经的那段时光，纯粹的友谊，你我他的日子。 不，确切的说是回不到了，没有也许。时间也许会治愈创伤，却再也稀释不掉那些记忆了，破碎的，令人心痛着的。 就让你的任性，你爽朗的笑声消失在我的生命里吧，这对彼此都好，不是吗？ 露寒霜重，望君珍重。</p><h2 id="欢聚和离别"><a href="#欢聚和离别" class="headerlink" title="欢聚和离别"></a>欢聚和离别</h2><p>嫌弃涮吧太挤、宿舍太差。而如今却又开始怀念起了。 回校的5天里，时间显得如此的飞快。忙碌于整理论文，找导师，修改论文。我们甚至再也没有时间把食堂挨个吃一遍，再也没有机会去小操场散步，压腿，跑几圈。再也不能够在某个周末的晚上去校外的美食街去扫荡美食了。而一切的一切却又仿佛如昨。 拍毕业照大概是最感动的时间吧，80多个人接近半年时间没有相见，匆匆的从全国各地各个岗位角落，来完成这一历史性定格的瞬间。那种感觉说不出来，遥远而陌生，熟悉而又不舍。相信表面平静欢愉，心里实则已经波涛汹涌了吧。 离别的时候在包头站拍下夜景，很美。就像四年前我刚踏入包头那片炙土那样，就像四年前我所第一次见到的伸手可触的蓝天，和美到令人心碎的晚霞。仿佛我又回到四年前，骑着单车初来乍到。带着对这座城市的陌生惊喜，行驶在阿尔丁大街。稀疏的车辆人流，晚风吹散着盛夏的余热，一切都很好。 在我离别时，这座陪伴四年的城市，就像多年的老友目送着远去的我，深情而又慈祥。</p><h2 id="遗憾"><a href="#遗憾" class="headerlink" title="遗憾"></a>遗憾</h2><p>12月16号，充满遗憾的一天。 原本打算趁着周末时间去参加PHP开发者年会，却因为加班而成为了泡影。 对于加班，没什么个人私事，只要是公司需要，我会无条件的服从，这是对工作的态度。但仍然觉得是个遗憾。 虽然初入职业生涯不久，也不是什么技术大牛，但却一直对技术充满着热情，也很崇拜业界大牛，他们对于PHP发展所做的贡献。而且技术交流可以让我开拓眼界，明确自己坐标和发展的方向，这对于个人发展和成长都是大有裨益的。 早上8点，前往公司方向的公交上，收到老爸和老妈的红包，520，生日快乐！才意识到，这也是我步入社会第一个身在他乡将要一个人度过的生日。一阵阵暖流从内心涌向了后背，直至遍布到了全身，很感动。 记得那天加班到很晚，回去后还是忍不住发了一条说说：恩，美好的一天，生日快乐！。</p><h2 id="狼狈"><a href="#狼狈" class="headerlink" title="狼狈"></a>狼狈</h2><p>不知道狼狈的定义是什么，不过如果我要是被房东赶出来，行李都没来得及收拾，房子更没来得及找，这算不算是件很狼狈的事了！ 北京公寓整改，违规的公寓都进行了拆除整治。原本房子也快到期，打算趁着周六找房，周日搬出去，不想周六加了一天的班。离开公司已经是凌晨。 仍记得从公司出来的路上我是多么的狼狈，因为房子停水停电停暖，加之项目上线每日加班，所以那段日子可以说是得过且过。 从公司离开并没有直接回去，因为我知道等待我的是漆黑寒冷的夜，没有水及暖气。我不得不去找房子，搬家。至少先出去找个旅馆安顿下自己，明天找房。从北门走向鲁疃小区北，一路上凛冽的寒风，吹过我凌乱的头发以及疲倦的脸，当我走到十字路口，一阵突如其来的无助狼狈感涌上心头，那一刻我甚至不知道我该去哪儿，不知道接下来该做什么。哼着sam smith的drowning shadows 徘徊在暗淡灯光下的十字路口。发呆了很久，还是选择了回去，毕竟很晚了。偌大的路，昏暗的灯光，睡去的长夜，耳畔只剩下风声，脚步声，以及我细微的呼吸声。 周日一大早被房东吵醒，嚷嚷着让我搬出去。 从路边雇了辆搬家的小型货车，联系了在京的同学，就匆匆上了路。路上司机和我说，你们公寓，明天就要拆了。 我就那样狼狈的度过了一周。</p><h2 id="久别后的小聚"><a href="#久别后的小聚" class="headerlink" title="久别后的小聚"></a>久别后的小聚</h2><p>2.10下午4点，从天通苑北乘地铁，近两个小时的路程去南站送别大学舍友。 不到两个小时的路程，坐过了一站公交，然而心里还是很激动，毕业后已经半年的时间没有见面了。 祯哥、舍长和我在车站旁李先生加州面馆点了面。平时话不是很多，见到他们，感觉话匣子就打开了。聊了很多关于生活、工作上的事情。 大学期间宿舍就建立了很深的友情，做什么事情，都是一个宿舍全体行动。毕业后我们都辗转奉献于全国不同的工作岗位。能聚到一起是很令人激动的事情了。送别完舍长已经近晚上10点。和祯哥回去的路上，因为聊得投入，也没少走错路。新的一年都要好好的，425兄弟们，加油！</p><h2 id="新年伊始"><a href="#新年伊始" class="headerlink" title="新年伊始"></a>新年伊始</h2><p>新年的脚步在炮竹声中来临了。2018，满载着期待、希望和成长的一年。希望不负时光，沉淀自己、超越自己！一切安好。</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Sat Jan 19 2019 15:35:00 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;过去的一年是个百感交集的一年。毕业的欣喜，离别的惆怅，求职以及工作的艰辛。都在这不短不长，不声不响的一年中发生着。&lt;/p&gt;&lt;h2 id=&quot;充实的
      
    
    </summary>
    
      <category term="随笔" scheme="http://www.i4ward.cn/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="http://www.i4ward.cn/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
</feed>
